# structurelint configuration
# Generated by: structurelint --init
# Documentation: https://github.com/structurelint/structurelint

root: true

exclude:
  - testdata/**
  - .git/**
  - __pycache__/**
  - .pytest_cache/**
  - .mypy_cache/**
  - .ruff_cache/**
  - venv/**
  - .venv/**
  - node_modules/**
  - dist/**
  - build/**
  - legacy_archive/**
  - examples/**
  - htmlcov/**
  - models/**
  - "*.egg-info/**"

rules:
  # Phase 0: Basic filesystem structure
  max-depth:
    max: 10

  max-files-in-dir:
    max: 100

  max-subdirs:
    max: 30

  # Documentation requirements (commented out - enable when ready)
  # file-existence:
  #   "README.md": "exists:1"

  disallowed-patterns:
    - "*.tmp"
    - "*.bak"
    - ".DS_Store"

  # Naming conventions - enforce Python snake_case
  naming-convention:
    "**/*.py": "snake_case"

  # File existence rules
  # Note: These are disabled because structurelint checks EVERY directory
  # Instead, we rely on manual verification at project root
  # file-existence:
  #   "README.md": "exists:1"    # Root should have README
  #   "LICENSE": "exists:1"      # Root should have LICENSE
  #   "requirements.txt": "exists:1"  # Root should have requirements
  #   ".env": "exists:0"         # No .env files anywhere
  #   "*.secret": "exists:0"     # No .secret files anywhere

  # Test file validation
  # Enforces that all source files have corresponding test files
  test-adjacency:
    pattern: "separate"
    test-dir: "tests/unit"
    file-patterns:
      - "**/*.py"
    exemptions:
      - "**/__init__.py"    # Package initializers
      - "**/conftest.py"    # Pytest configuration
      - "setup.py"          # Setup script
      - "run.py"            # Entry point script
      - "test_dictation.py" # Root-level test file
      - "**/test_*.py"      # Test files themselves
      - "src/commands/base.py"  # Infrastructure - tested through implementations

  test-location:
    integration-test-dir: "tests/integration"
    allow-adjacent: false
    exemptions:
      - "testdata/**"
      - "tests/**"          # Allow all tests in tests/ directory
      - "test_*.py"         # Allow root-level test files

# Phase 1: Architectural layers
layers:
  - name: "ui"
    description: "User interface layer - overlays and UI components"
    paths:
      - "src/overlays/**"
      - "src/ui/**"
    can-import:
      - "commands"
      - "core"

  - name: "commands"
    description: "Command processing and execution layer"
    paths:
      - "src/commands/**"
    can-import:
      - "core"
      - "audio"
      - "transcription"

  - name: "audio"
    description: "Audio processing and VAD"
    paths:
      - "src/audio/**"
    can-import:
      - "core"

  - name: "transcription"
    description: "Text processing and transcription"
    paths:
      - "src/transcription/**"
    can-import:
      - "core"

  - name: "core"
    description: "Core infrastructure - config, events, etc."
    paths:
      - "src/core/**"
    can-import: []

# Phase 2: Dead code detection
entrypoints:
  - "src/main.py"
  - "run.py"
  - "setup.py"
  - "tests/**/test_*.py"
  - "test_*.py"
